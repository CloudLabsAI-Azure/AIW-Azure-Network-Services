# Exercise 3: Provision Sample Application in Existing Network

Duration: 60-70 mins

## Overview

In this exercise, you will create the virtual machine's and place them in the backendpool of load balancer then you will check the load balancing between virtual machines. You will also test the behaviour of load balancer in case of VM failover.

This exercise includes the following tasks:

*	Deploy VM using pre-built ARM Template in existing network. 

*	Add Public IP to the virtual machine 

*	Configure NSGs/ASGs and allow Application Access

*	Test Application 

*	Setup Load Balancing :

     * Provision Secondary VM.
       
     * Provision Load Balancing using External Load Balancer. 
       
     * Test LB & VM failover.


## Task 1: Deploy VM using pre-built ARM Template in existing network. 

In this task, you will be deploying a virtual machine without public IP address using ARM template.

1. From the Azure portal menu, in the search box, type deploy, and then select **Deploy a custom template**.

    ![template](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/deploytemp.png?raw=true)
    
2. Now select **Build your own template in the editor** from Custom deployment tab.

    ![template deployment](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/build%20template.png?raw=true)
    
3. Replace the existing script in the editor with the below JSON script.

    ```json
    {
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "azureUsername": {
            "type": "String"
        },
        "azurePassword": {
            "type": "SecureString"
        },
        "deploymentID": {
            "type": "String"
        }
    },
    "variables": {
        "azureTenantID": "[subscription().tenantId]",
        "azureSubscriptionID": "[subscription().subscriptionId]",
        "resourceGroupName": "[resourceGroup().name]",
        "location": "[resourceGroup().location]",
        "availabilitySetName": "[concat('ANS-AS-',parameters('deploymentID'))]",
        "availabilitySetPlatformFaultDomainCount": "2",
        "jumphost": "[concat('VM1-',parameters('deploymentID'))]",
        "adminUsername": "demouser",
        "adminPassword": "Password.1!!",
        "availabilitySetPlatformUpdateDomainCount": "5",
        "networkInterfaceName1": "[concat(variables('jumphost'), '-nic')]",
        "virtualMachineSize": "Standard_D2s_v3",
        "vmPublicIpDnsName": "[concat('labvm',uniqueString(resourceGroup().id))]",
        "apiVersion": "[providers('Microsoft.ServiceBus', 'namespaces').apiVersions[0]]",
        "rgName": "hands-on-lab-",
        "virtualNetworkName": "[concat('NSVnet-',parameters('deploymentID'))]",
        "SubnetName": "Internal",
        "subnetRef": "[resourceId(variables('rgName'),'Microsoft.Network/virtualNetworks/subnets', variables('virtualNetworkName'), variables('SubnetName'))]"
    },
    "resources": [
        {
            "type": "Microsoft.Network/networkInterfaces",
            "apiVersion": "2016-09-01",
            "name": "[variables('networkInterfaceName1')]",
            "location": "[variables('location')]",
            "dependsOn": [],
            "properties": {
                "ipConfigurations": [
                    {
                        "name": "ipconfig1",
                        "properties": {
                            "subnet": {
                                "id": "[variables('subnetRef')]"
                            },
                            "privateIPAllocationMethod": "Dynamic"
                        }
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Compute/virtualMachines",
            "apiVersion": "2021-03-01",
            "name": "[variables('jumphost')]",
            "location": "[variables('location')]",
            "dependsOn": [
                "[concat('Microsoft.Network/networkInterfaces/', variables('networkInterfaceName1'))]",
                "[concat('Microsoft.Compute/availabilitySets/', variables('availabilitySetName'))]"
            ],
            "properties": {
                "hardwareProfile": {
                    "vmSize": "[variables('virtualMachineSize')]"
                },
                "storageProfile": {
                    "osDisk": {
                        "createOption": "fromImage",
                        "managedDisk": {
                            "storageAccountType": "Premium_LRS"
                        }
                    },
                    "imageReference": {
                        "publisher": "MicrosoftWindowsServer",
                        "offer": "WindowsServer",
                        "sku": "2019-datacenter-gensecond",
                        "version": "latest"
                    }
                },
                "networkProfile": {
                    "networkInterfaces": [
                        {
                            "id": "[resourceId('Microsoft.Network/networkInterfaces', variables('networkInterfaceName1'))]"
                        }
                    ]
                },
                "osProfile": {
                    "computerName": "[variables('jumphost')]",
                    "adminUsername": "[variables('adminUsername')]",
                    "adminPassword": "[variables('adminPassword')]",
                    "windowsConfiguration": {
                        "enableAutomaticUpdates": true,
                        "provisionVmAgent": true
                    }
                },
                "availabilitySet": {
                    "id": "[resourceId('Microsoft.Compute/availabilitySets', variables('availabilitySetName'))]"
                }
            }
        },
        {
            "type": "Microsoft.Compute/availabilitySets",
            "apiVersion": "2019-07-01",
            "name": "[variables('availabilitySetName')]",
            "location": "[variables('location')]",
            "sku": {
                "name": "Aligned"
            },
            "properties": {
                "platformFaultDomainCount": "[variables('availabilitySetPlatformFaultDomainCount')]",
                "platformUpdateDomainCount": "[variables('availabilitySetPlatformUpdateDomainCount')]"
            }
        },
        {
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "apiVersion": "2015-06-15",
            "name": "[concat(variables('jumphost'),'/', 'winExtension')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[concat('Microsoft.Compute/virtualMachines/', variables('jumphost'))]"
            ],
            "tags": {
                "displayName": "VM Extension"
            },
            "properties": {
                "publisher": "Microsoft.Compute",
                "type": "CustomScriptExtension",
                "typeHandlerVersion": "1.8",
                "autoUpgradeMinorVersion": true,
                "settings": {
                    "fileUris": [
                        "https://raw.githubusercontent.com/Divyasri199/Templates/main/netsol.ps1"
                    ]
                },
                "protectedSettings": {
                    "commandToExecute": "powershell.exe -ExecutionPolicy Unrestricted -File netsol.ps1"
                }
            }
        }
    ],
    "outputs": {}
    }
 
4. Replace the Resource Group name in the template with the below mentioned name and double-check the subnet name, then **Save** the template.

    - rgName : **hands-on-lab-<inject key="DeploymentID" enableCopy="true"/>**

    - Subnet Name : **Internal**

    ![template](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/vmcreation.png?raw=true)
    
5. Enter the following values to deploy the template.

    - Resource Group : **hands-on-lab-<inject key="DeploymentID" enableCopy="true"/>**

    - User name : **demouser**

    - Password : **Password.1!!**
    
    - Deployment ID: **<inject key="DeploymentID" enableCopy="true"/>**

    - Click on **Review + Create**

      ![template deployment](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/vmcreate1.png?raw=true)
      
 6. Review the template and select **Create**

      ![template deployment](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/vmcreate3.png?raw=true)
      
7. After the template has been successfully created, click **Go to Resource**.

    ![go to resource](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/vmcreate2.png?raw=true)


## Task 2: Add Public IP to the virtual machine

### Overview

In this task, you will associate the Public IP Address to Virtual Machine under same Vnet.

1. Navigate to the resource group **hands-on-lab-<inject key="DeploymentID" enableCopy="false"/>** and from  the **Overview** tab  select the virtual machine **VM1-<inject key="DeploymentID" enableCopy="false"/>**.

   ![vm1.1](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/pbip1.png?raw=true)
   
2. On the Virtual machine **Overview** page observe that the virtual machine dosen't have public IP address associated. 

   ![noIP](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/pb2.png?raw=true)
   
3. Navigate back to the **Azure Portal** home page by selecting the **Home**.

   ![Create resource](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/pb8.png?raw=true)
     
4. From the Azure portal menu, in the search box, type public, and then select **Public IP addresses**.

   ![Create resource](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/pb3.png?raw=true)
     
5. Now click on **Create public IP address**.

    ![create Vnet](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/pb4.png?raw=true)
    
6. On **Create public IP adress** page, enter the following details:

   - SKU  : Select **Standard**

   - Tier : Select **Regional**

   - Name : Enter **PublicIP1-<inject key="DeploymentID" enableCopy="false"/>**

   - Subscription: Choose your **Subscription Group**

   - Resource Group : Select **hands-on-lab-<inject key="DeploymentID" enableCopy="false"/>**

   - Click on **Create**.

   ![createIP](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/publicipcreation.png?raw=true)
   
6. Monitor the deployment status by selecting **Notifications** Bell icon at the top of the portal. In a minute or so, you should see a confirmation of the successful deployment. Select  **Go to Resource**.

    ![Create IP](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/pb7.png?raw=true)

7. Now to associate the Public IP address with the VM, click on **Associate** and in  **Associate Public IP address** tab enter the below details:

   - Resource Type : Select **Network Interface** from drop down.

   - Network Interface : Select Network Interface of the newly deployed VM.

   - Click on **OK**

   ![AssociatePIP](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/pb5.png?raw=true)
   
8. Return to the resource group and select the **VM1-<inject key="DeploymentID" enableCopy="false"/>** from the **Overview** tab.

9. Now on the virtual machine's **Overview** tab observe the newly created **Public IP address** is associated.

   ![PIP](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/pb6.png?raw=true)
   
   
## Task 3: Configure NSGs/ASGs and allow Application Access

In this task, you will create a Network Security Group and access for Application.

1. From your **Azure Portal**, in the search box type network, and then select **Network Security Group**.

   ![NSG](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/networksecurity.png?raw=true)
   
2. Click on **Create network security group**

    ![nsg create](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/nsg2.png?raw=true)
   
2. On the **Basics** tab of  Create network security group enter the following information, and select **Review + create**:

   - Resource Group : Select your resource group **hands-on-lab-<inject key="DeploymentID" enableCopy="false"/>**

   - Name : **NSG-<inject key="DeploymentID" enableCopy="true"/>**.

   ![NSG](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/nsg1.png?raw=true)
   
3. Monitor the deployment status by selecting **Notifications** Bell at the top of the portal. In a minute or so, you should see a confirmation of the successful deployment. Select **Go to Resource**.

    ![go to resource](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/nsg3.png?raw=true)
    
4. Now to associate Network security group to the VM follow the below instructions:

     - Under **Settings** select **Network Interface**

     - Click on **Associate**

     - Under the **Network interface associations** select **VM1-<inject key="DeploymentID" enableCopy="false"/>-nic**

     - Click on **Ok**

      ![Associate NSG to VM](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/nsg4.png?raw=true)
      
5. On the **Network Security Group** blade, Select **Inbound security Rules** under **Settings** and click on **Add**.

      ![nsg](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/nsg5.png?raw=true)

6. Provide the following information under **Add inbound security rule**:

     - **Destination Port Range**: Enter **3389**
   
     - Name : **RDP**

     - Click on **Add**   

       ![Add RDP](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/nsg8.png?raw=true)


7. Repeat the step 5 to add new NSG rule for port 80

   - **Destination Port Range**: Enter **80**
   
   - Name : **Port_80**

   - Click on **Add**

     ![port_80](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/nsg6.png?raw=true)
  
8. Repeat the step-5 to add new NSG rule for port 443

    - **Destination Port Range**: **443**

    - Name : **Port_443**

    - Click on **Add**

   ![Port 443](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/nsg7.png?raw=true)

     
 ## Task-4 : Test Application 
 
 
 ### Overview
  
  In this task you will check wheater the we are able to connect to the created application.
     
1. Navigate to the resource group **hands-on-lab-<inject key="DeploymentID" enableCopy="false"/>** and select the virtual machine **VM1-<inject key="DeploymentID" enableCopy="false"/>** from **Overview** tab

   ![vm1.1](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/raw/main/media/pbip1.png?raw=true)

2. Now, copy the **Public IP address**  from the virtual machine's **Overview** page and paste it in new tab

   ![PIP](https://raw.githubusercontent.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/main/media/pb6.png)
   
3. You'll be directed to the webpage shown in the screenshot below.

    ![webapp](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/website.png?raw=true)
   
   
## Task 5 : Setup Load Balancing 
 
## Task 5.1 : Provision Secondary VM
 
 
### Overview
 
In this task you will be creating seconday VM under same Availability Set.
    
1. From the Azure portal menu, in the search box, type deploy, and then select Deploy a custom template.

2. Now select **Build your own template in the editor** from Custom deployment tab.

3. Replace the existing script in the editor with the below JSON script and **Save** the template.

   ```json
   {
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "azureUsername": {
            "type": "String"
        },
        "azurePassword": {
            "type": "SecureString"
        },
        "deploymentID": {
            "type": "String"
        },
        "rgName": {
            "type": "String"
        }
    },
    "variables": {
        "azureTenantID": "[subscription().tenantId]",
        "azureSubscriptionID": "[subscription().subscriptionId]",
        "resourceGroupName": "[resourceGroup().name]",
        "location": "[resourceGroup().location]",
        "availabilitySetName": "[concat('ANS-AS-',parameters('deploymentID'))]",
        "availabilitySetPlatformFaultDomainCount": "2",
        "jumphost": "[concat('VM2-',parameters('deploymentID'))]",
        "adminUsername": "demouser",
        "adminPassword": "Password.1!!",
        "availabilitySetPlatformUpdateDomainCount": "5",
        "publicIpAddressDNSName": "[concat('labvm-', uniqueString(resourceGroup().id))]",
        "publicIpAddressName": "[concat('PublicIP2-',parameters('deploymentID')) ]",
        "networkInterfaceName1": "[concat(variables('jumphost'), '-nic')]",
        "virtualMachineSize": "Standard_D2s_v3",
        "vmPublicIpDnsName": "[concat('labvm',uniqueString(resourceGroup().id))]",
        "apiVersion": "[providers('Microsoft.ServiceBus', 'namespaces').apiVersions[0]]",
        "virtualNetworkName": "[concat('NSVnet-',parameters('deploymentID'))]",
        "networkSecurityGroupName": "[concat('NSG2-',parameters('deploymentID'))]",
        "SubnetName": "Internal",
        "subnetRef": "[resourceId(parameters('rgName'),'Microsoft.Network/virtualNetworks/subnets', variables('virtualNetworkName'), variables('SubnetName'))]"
    },
    "resources": [
        {
            "type": "Microsoft.Network/networkInterfaces",
            "apiVersion": "2016-09-01",
            "name": "[variables('networkInterfaceName1')]",
            "location": "[variables('location')]",
            "dependsOn": [
                "[concat('Microsoft.Network/publicIpAddresses/', variables('publicIpAddressName'))]"
            ],
            "properties": {
                "ipConfigurations": [
                    {
                        "name": "ipconfig1",
                        "properties": {
                            "subnet": {
                                "id": "[variables('subnetRef')]"
                            },
                            "privateIPAllocationMethod": "Dynamic",
                            "publicIpAddress": {
                                "id": "[resourceId(resourceGroup().name,'Microsoft.Network/publicIpAddresses', variables('publicIpAddressName'))]"
                            }
                        }
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Network/publicIpAddresses",
            "apiVersion": "2017-08-01",
            "name": "[variables('publicIpAddressName')]",
            "location": "[variables('location')]",
            "sku": {
                "name": "Standard"
            },
            "properties": {
                "publicIpAllocationMethod": "static",
                "dnsSettings": {
                    "domainNameLabel": "[concat(variables('publicIpAddressDNSName'))]"
                }
            }
        },
        {
            "type": "Microsoft.Network/networkSecurityGroups",
            "apiVersion": "2017-06-01",
            "name": "[variables('networkSecurityGroupName')]",
            "location": "[variables('location')]",
            "properties": {
                "securityRules": [
                    {
                        "name": "default-allow-rdp",
                        "properties": {
                            "priority": 110,
                            "protocol": "TCP",
                            "access": "Allow",
                            "direction": "Inbound",
                            "sourceAddressPrefix": "*",
                            "sourcePortRange": "*",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "3389"
                        }
                    },
                    {
                        "name": "Port_80",
                        "properties": {
                            "description": "Allow WEB",
                            "protocol": "TCP",
                            "sourcePortRange": "*",
                            "destinationPortRange": "80",
                            "sourceAddressPrefix": "Internet",
                            "destinationAddressPrefix": "*",
                            "access": "Allow",
                            "priority": 101,
                            "direction": "Inbound"
                        }
                    },
                    {
                        "name": "Port_443",
                        "properties": {
                            "description": "Allow WEB",
                            "protocol": "TCP",
                            "sourcePortRange": "*",
                            "destinationPortRange": "443",
                            "sourceAddressPrefix": "Internet",
                            "destinationAddressPrefix": "*",
                            "access": "Allow",
                            "priority": 102,
                            "direction": "Inbound"
                        }
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Compute/virtualMachines",
            "apiVersion": "2021-03-01",
            "name": "[variables('jumphost')]",
            "location": "[variables('location')]",
            "dependsOn": [
                "[concat('Microsoft.Network/networkInterfaces/', variables('networkInterfaceName1'))]",
                "[concat('Microsoft.Compute/availabilitySets/', variables('availabilitySetName'))]"
            ],
            "properties": {
                "hardwareProfile": {
                    "vmSize": "[variables('virtualMachineSize')]"
                },
                "storageProfile": {
                    "osDisk": {
                        "createOption": "fromImage",
                        "managedDisk": {
                            "storageAccountType": "Premium_LRS"
                        }
                    },
                    "imageReference": {
                        "publisher": "MicrosoftWindowsServer",
                        "offer": "WindowsServer",
                        "sku": "2019-datacenter-gensecond",
                        "version": "latest"
                    }
                },
                "networkProfile": {
                    "networkInterfaces": [
                        {
                            "id": "[resourceId('Microsoft.Network/networkInterfaces', variables('networkInterfaceName1'))]"
                        }
                    ]
                },
                "osProfile": {
                    "computerName": "[variables('jumphost')]",
                    "adminUsername": "[variables('adminUsername')]",
                    "adminPassword": "[variables('adminPassword')]",
                    "windowsConfiguration": {
                        "enableAutomaticUpdates": true,
                        "provisionVmAgent": true
                    }
                },
                "availabilitySet": {
                    "id": "[resourceId('Microsoft.Compute/availabilitySets', variables('availabilitySetName'))]"
                }
            }
        },
        {
            "type": "Microsoft.Compute/availabilitySets",
            "apiVersion": "2019-07-01",
            "name": "[variables('availabilitySetName')]",
            "location": "[variables('location')]",
            "sku": {
                "name": "Aligned"
            },
            "properties": {
                "platformFaultDomainCount": "[variables('availabilitySetPlatformFaultDomainCount')]",
                "platformUpdateDomainCount": "[variables('availabilitySetPlatformUpdateDomainCount')]"
            }
        },
        {
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "apiVersion": "2015-06-15",
            "name": "[concat(variables('jumphost'),'/', 'winExtension')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[concat('Microsoft.Compute/virtualMachines/', variables('jumphost'))]"
            ],
            "tags": {
                "displayName": "VM Extension"
            },
            "properties": {
                "publisher": "Microsoft.Compute",
                "type": "CustomScriptExtension",
                "typeHandlerVersion": "1.8",
                "autoUpgradeMinorVersion": true,
                "settings": {
                    "fileUris": [
                        "https://raw.githubusercontent.com/Divyasri199/Templates/main/netsol.ps1"
                    ]
                },
                "protectedSettings": {
                    "commandToExecute": "powershell.exe -ExecutionPolicy Unrestricted -File netsol.ps1"
                }
            }
        }
    ],
    "outputs": {}
    }
 
4. On the **Custom deployment** basics tab enter the following values to deploy the template.

    - Resource Group : Select **hands-on-lab-<inject key="DeploymentID" enableCopy="true"/>**

    - User name : Enter **demouser**

    - Password : Enter **Password.1!!**
    
    - Deployment ID:  Enter **<inject key="DeploymentID" enableCopy="true"/>**

    - Rg Name: Enter **hands-on-lab-<inject key="DeploymentID" enableCopy="true"/>**

    - Click on **Review + Create**

    ![create Loadbalancer](https://github.com/CloudLabsAI-Azure/AIW-Azure-Network-Solutions/blob/main/media/arm2.png?raw=true)
     
5. Once the deployment is complete, navigate back to the resource group **hands-on-lab-<inject key="DeploymentID" enableCopy="false"/>** and select the virtual machine **VM2-<inject key="DeploymentID" enableCopy="false"/>** from the Overview tab.

7. Now copy the Public IP address from the virtual machine's Overview page and paste it in new tab.

      ![vm2pip](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/vm2pip1.png?raw=true)
      
8. You'll be directed to the webpage with the name of VM2-<inject key="DeploymentID" enableCopy="false"/> shown in the screenshot below.

      ![vm2](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/webpage.png?raw=true)
     
## Task 5.2 : Provision Load Balancing using External Load Balancer 

### Overview

In this task, you will be creating an exertal load balancer
    
1. Search for the **Load balancer** from **Azure Portal** and select **Create**.
  
  ![create Loadbalancer](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/LB%20create.png?raw=true)
  
     
2. Under the **basic** tab of Load Balancer enter the following commands:

     - Resource Group : **hands-on-lab-<inject key="DeploymentID" enableCopy="false"/>**

     - Name  : **ANS-LB<inject key="DeploymentID" enableCopy="false"/>**

     - Type  : **Public**

     - Click on **Frontend IP Configuration**

        ![Basic LB](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/creatingLBB.png?raw=true)
        
8.  Click on **Add a frontend IP**

       ![frontendIP](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/Front%20endIP.png?raw=true)
       
9.  Enter the following information to create **Frontend IP** :

     - Name : **FIP-<inject key="DeploymentID" enableCopy="false"/>**

     - IP Version : **IPv4**

     - IP type : **IP Address**

     - Under **Public IP address** click on **Create new**
      
     -  Now add **Name** as **PublicIP-<inject key="DeploymentID" enableCopy="false"/>** 
      
     -  click on **Ok**.

       ![frontendIP](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/FrontendIP.png?raw=true)
       
10. Now click on **Add**.

     ![add frontend ip](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/Add%20frontend%20ip%20address.png?raw=true)
    
11. After adding the frontend IP Address, you can observe the screen as mentioned in the below screenshot then click on **Backend Pool**

    ![next to backend pool](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/Next-to-backendpool.png?raw=true)
    
12. Follow the below instructions to create **Backend Pool**

     - **Name** : **BackendPool-<inject key="DeploymentID" enableCopy="true"/>**

     - **Virtual Network** : Select the created Vnet **NSVnet-<inject key="DeploymentID" enableCopy="true"/>** from drop down list

     -  Select **Add** to create add Virtual machines.

      ![add vm at backendpool](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/backendpoool.png?raw=true)
      
 13. To add the virtual machines in the backend pool, select both the VMs and click on **Add** 

     ![Add Vm at backendpool](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/add%202%20vms.png?raw=true)
     
 14. Now select existing **Add** button to **Add backend pool**

      ![add backendpool](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/add%20on%20add.png?raw=true)
      
15. After adding the virtual machines in the backend pool, you can observe the screen as mentioned in below screenshot, after reviewing click on **Inbound rules**.

     ![review backendpools](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/reviewbackendpool.png?raw=true)
     
16. To create load balancing rule, click on **Add a load balancing rule** and follow the below mentioned instructions:

     - Name : **LoadBalancing-<inject key="DeploymentID" enableCopy="true"/>**

     - Frontend IP address : **FIP-<inject key="DeploymentID" enableCopy="true"/>** from drop down list.

     - Port : **80**

     - Backend Port : **80**

     - Backend Pool : **BackendPool-<inject key="DeploymentID" enableCopy="true"/>** from drop down list.

     ![loadbalincing](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/Loadbalancing.png?raw=true)
     
     - Health Probe: To create health probe click on **create new** and follow the below instructions
      
     - **Name** : **HealthProbe-<inject key="DeploymentID" enableCopy="true"/>**
      
     -   **Protocol** : **HTTP** 
        
     -   select **Ok**

       ![health probe](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/healthprobe.png?raw=true)
       
      - TCP reset: **Enabled**

      - Select **Add**

17. After adding Load balancing rule click on **Review + Create** and select **Create**

      ![create lb](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/addedLB.png?raw=true)
      
      
##  Task- 5.3 : Test LB & VM failover.

1. After the deployment of Load balancer got succeeded, select on **Go to the resouce**

    ![go to resource](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/click%20on%20goto.png?raw=true)
    
2. Now you can find the same **Public Ip address** for Load balancer and previously deployed 2 virtual machines.

3. Copy the **public IP address** and paste it into a new tab to access the webpage we set up in task-4

     ![webapp](https://github.com/Divyasri199/AIW-Azure-Network-Solutions/blob/prod/media/website.png?raw=true)
     
4. To test for VM failover, go back to **VM1-<inject key="DeploymentID" enableCopy="false"/>** in the resource group **hands-on-lab-<inject key="DeploymentID" enableCopy="true"/>** and deallocate the VM  by clicking on **Stop**.

5. Navigate back to the browser where you accessed the public IP address and refresh the page, you can observe the change in VM name.
